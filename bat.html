<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Bat</title>
  <link rel="stylesheet" href="css/main.css" media="screen" title="no title" charset="utf-8">
  <script src="js/jquery.min.js" charset="utf-8"></script>
</head>

<body>
  <!-- <form id="form1" runat="server">
    <input type='file' id="imgInp" />
    <img id="blah" src="#" alt="your image" style="display:none;" />
  </form> -->
  <!-- <script src="./bower_components/caman/dist/caman.min.js" charset="utf-8"></script> -->
  <script src="js/three.js" charset="utf-8"></script>
  <script src="js/OrbitControls.js" charset="utf-8"></script>
  <script src="js/OBJLoader.js" charset="utf-8"></script>
  <script type="text/javascript">
    // Creating variables at one place
    var scene, camera, renderer,
      width, height, light,
      loader, material, mesh;

    // methods to call
    init();
    animate();

    // defining methods
    function init() {
      // Creating scene
      scene = new THREE.Scene();
      width = window.innerWidth;
      height = window.innerHeight;

      // Creating renderer
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(width, height);
      document.body.appendChild(renderer.domElement);
      renderer.setClearColor(0x777777, 1);
      renderer.recieveShadow = true;
      renderer.shadowMap.enabled;

      // Creating camera
      camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 10000);
      camera.position.set(1000, 55, 51);
      scene.add(camera);

      // Adding Controls
      var controls = new THREE.OrbitControls(camera, renderer.domElement);
      // controls.enableRotate = false;
      controls.enableZoom = false;

      // Updating viewport
      window.addEventListener('resize', function() {
        renderer.setSize(width, height);
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
      });

      // Adding Ambient light
      amblight = new THREE.AmbientLight(0xffffff);
      scene.add(amblight);

      // Adding Directional light
      dirlight = new THREE.DirectionalLight(0xffffff, 0.5);
      dirlight.shadowCameraNear = 1;
      dirlight.shadowCameraFar = 150;
      dirlight.castshadow = true;

      var spotLight = new THREE.SpotLight(0x999999);
      spotLight.position.set(0, 0, 0);
      spotLight.castShadow = true;
      camera.add(spotLight);

      loader = new THREE.JSONLoader();
      loader.load("js/json/bat2.json", function(geometry) {
        var texture2 = new THREE.TextureLoader();
        var url = 'img/bat_texture.jpg';
        texture2.load(
          url,
          function(texture) {
            var material = new THREE.MeshLambertMaterial({
              map: texture
            });
            texture.needsUpdate = true;
            material.setValues();
            mesh = new THREE.Mesh(geometry, material);
            mesh.castShadow = true;
            mesh.rotation.x = 0;
            mesh.rotation.y = 0;
            mesh.rotation.z = 0;
            scene.add(mesh);
          },
          function(xhr) {
            console.log((xhr.loaded / xhr.total * 100) + '% loaded');
          },
          function(xhr) {
            console.log('An error happened');
          }
        );
      // });
      //
      // var canvas = document.createElement("canvas");
      // $("canvas").addClass("mycanvas");
      // canvas.width = 1200;
      // canvas.height = 396;
      // var c = canvas.getContext("2d");
      // function readURL(input) {
      //   if (input.files && input.files[0]) {
      //     var reader = new FileReader();
      //     reader.onload = function(e) {
      //       $('#blah').attr('src', e.target.result);
      //       src = $('#blah').attr('src');
      //       var image1 = new Image();
      //       image1.src = "img/bat_texture.jpg";
      //       var image2 = new Image();
      //       $(image2).attr('id', 'myimage2');
      //       image2.src = src;
      //       c.drawImage(image1, 0, 0, 1200, 396, 0, 0, 1200, 396);
      //       c.drawImage(image2, 0, 0, 500, 500, 400, 0, 200, 200);
      //       var imgsrc = canvas.toDataURL("image/png", 1.0);
      //       loader = new THREE.JSONLoader();
      //       loader.load("js/json/bat2.json", function(geometry) {
      //         var textur = new THREE.TextureLoader();
      //         textur.load(
      //           imgsrc,
      //           function(texture) {
      //             var material = new THREE.MeshPhongMaterial({
      //               map: texture
      //             });
      //             var mmesh = new THREE.Mesh(geometry, material);
      //             mmesh.castShadow = true;
      //             mmesh.rotation.x = 0;
      //             mmesh.rotation.y = 0;
      //             mmesh.rotation.z = 0;
      //             scene.add(mmesh);
      //           },
      //           function(xhr) {
      //             console.log((xhr.loaded / xhr.total * 100) + '% loaded');
      //           },
      //           function(xhr) {
      //             console.log('An error happened');
      //           }
      //         );
      //       });
      //     }
      //     reader.readAsDataURL(input.files[0]);
      //   }
      // }
      // $("#imgInp").change(function() {
      //   readURL(this);
      //   scene.remove(mesh);
      // });
    });
    }

    function animate() {
      requestAnimationFrame(animate);
      //mesh.rotation.z += 0.01;
      renderer.render(scene, camera);
    }

  </script>
</body>

</html>
