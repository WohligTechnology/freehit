<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pant</title>
  <link rel="stylesheet" href="css/main.css" media="screen" title="no title" charset="utf-8">
  <script src="js/jquery.min.js" charset="utf-8"></script>
</head>

<body>
  <div class="loading-bar" id="loading-bar">
    <div class="cccimage">
      <img src="img/ccc.png" class="rotate">
    </div>
  </div>
  <div id="three" style="display: none;"></div>
  <!-- <form id="form1" runat="server">
    <input type='file' id="imgInp" />
    <img id="blah" src="#" alt="your image" style="display:none;" />
  </form> -->
  <!-- <script src="./bower_components/caman/dist/caman.min.js" charset="utf-8"></script> -->
  <script src="js/three.js" charset="utf-8"></script>
  <script src="js/OrbitControls.js" charset="utf-8"></script>
  <script src="js/DDSLoader.js"></script>
  <script src="js/OBJLoader.js"></script>
  <script src="js/MTLLoader.js"></script>
  <script src="js/OBJMTLLoader.js"></script>
  <script type="text/javascript">

  var scene, camera, renderer, width, height, light, loader, material, mesh;
  var three = document.getElementById("three");

  // methods to call
  $(document).ready(function () {
    setTimeout(function () {
      init();
      animate();
    }, 500);
  });

  function init() {
    scene = new THREE.Scene();
    width = window.innerWidth;
    height = window.innerHeight;

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(width, height);
    three.appendChild(renderer.domElement);
    renderer.setClearColor(0x777777, 1);
    renderer.recieveShadow = true;

    camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 10000);
    camera.position.set(0, 0, 15);
    scene.add(camera);

    var controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableZoom = false;

    window.addEventListener('resize', function() {
      renderer.setSize(width, height);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    });

    amblight = new THREE.AmbientLight(0xaaaaaa);
    scene.add(amblight);

    dirlight = new THREE.DirectionalLight(0x777777, 0.5);
    dirlight.shadowCameraNear = 1;
    dirlight.shadowCameraFar = 150;
    dirlight.castshadow = true;

    var spotLight = new THREE.SpotLight(0x777777);
    spotLight.position.set(1000, 1000, 1000);
    spotLight.castShadow = true;
    camera.add(spotLight);

    // loader = new THREE.JSONLoader();
    // loader.load('res/pant/fullpant.json', function(geometry) {
    //   var texture2 = new THREE.TextureLoader();
    //   var url = 'img/pant.jpg';
    //   texture2.load(
    //     url,
    //     function(texture) {
    //       var material = new THREE.MeshPhongMaterial({
    //         map: texture
    //       });
    //       mesh = new THREE.Mesh(geometry, material);
    //       mesh.castShadow = true;
    //       mesh.rotation.x = 0;
    //       mesh.rotation.y = 0;
    //       mesh.rotation.z = 0;
    //       scene.add(mesh);
    //       document.getElementById("loading-bar").style.display = "none";
    //       document.getElementById("three").style.display = "block";
    //     },
    //     function(xhr) {
    //       console.log((xhr.loaded / xhr.total * 100) + '% loaded');
    //     },
    //     function(xhr) {
    //       console.log('An error happened');
    //     }
    //   );
    // });

    var texture = new THREE.TextureLoader().load("img/ccc_black.png");
    texture.wrapS = THREE.RepeatWrapping;
    texture.wrapT = THREE.RepeatWrapping;
    var cccgeometry = new THREE.PlaneGeometry(0.5, 0.5, 500);
    var cccmaterial = new THREE.MeshBasicMaterial({
      map: texture, transparent: true
    });
    sphere = new THREE.Mesh(cccgeometry, cccmaterial);
    sphere.castShadow = true;
    sphere.position.x = -2.7;
    sphere.position.y = 4;
    sphere.position.z = 1.3;
    sphere.rotation.y = -1;
    scene.add(sphere);

    var onProgress = function (xhr) {
      if (xhr.lengthComputable) {
        var percentComplete = xhr.loaded / xhr.total * 100;
      }
    };
    var onError = function (xhr) {};
    THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());
    var loader = new THREE.OBJMTLLoader();
    loader.load('res/fullpant/new/fullpant.obj', '', function (object) {
      scene.add(object);
      document.getElementById("loading-bar").style.display = "none";
      document.getElementById("three").style.display = "block";
    }, onProgress, onError);

    // var canvas = document.createElement("canvas");
    // $("canvas").addClass("mycanvas");
    // canvas.width = 1024;
    // canvas.height = 1024;
    // var c = canvas.getContext("2d");
    // function readURL(input) {
    //   if (input.files && input.files[0]) {
    //     var reader = new FileReader();
    //     reader.onload = function(e) {
    //       $('#blah').attr('src', e.target.result);
    //       src = $('#blah').attr('src');
    //       var image1 = new Image();
    //       image1.src = "img/pant.jpg";
    //       var image2 = new Image();
    //       $(image2).attr('id', 'myimage2');
    //       image2.src = src;
    //       c.drawImage(image1, 0, 0, 1024, 1024, 0, 0, 1024, 1024);
    //       c.drawImage(image2, 0, 0, 500, 500, 110, 385, 50, 50);
    //       var imgsrc = canvas.toDataURL("image/png", 1.0);
    //       loader = new THREE.JSONLoader();
    //       loader.load("js/json/trouser_01.json", function(geometry) {
    //         var textur = new THREE.TextureLoader();
    //         textur.load(
    //           imgsrc,
    //           function(texture) {
    //             var material = new THREE.MeshPhongMaterial({
    //               map: texture
    //             });
    //             var mmesh = new THREE.Mesh(geometry, material);
    //             mmesh.castShadow = true;
    //             mmesh.rotation.x = 0;
    //             mmesh.rotation.y = 0;
    //             mmesh.rotation.z = 0;
    //             scene.add(mmesh);
    //           },
    //           function(xhr) {
    //             console.log((xhr.loaded / xhr.total * 100) + '% loaded');
    //           },
    //           function(xhr) {
    //             console.log('An error happened');
    //           }
    //         );
    //       });
    //     }
    //     reader.readAsDataURL(input.files[0]);
    //   }
    // }
    // $("#imgInp").change(function() {
    //   readURL(this);
    //   scene.remove(mesh);
    // });
  }

  function animate() {
    requestAnimationFrame(animate);
    // mesh.rotation.y += 0.01;
    renderer.render(scene, camera);
  }

  </script>
</body>
</html>
